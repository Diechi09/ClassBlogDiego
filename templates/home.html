{% extends "base.html" %}
{% block content %}
  <h1>Home Page</h1>

  <!-- Flair filters -->
  <div style="margin:.5rem 0 1rem;">
    <strong>Filter:</strong>
    <a href="{{ url_for('home') }}"
       style="margin-left:.5rem; {{ 'text-decoration:underline;' if not selected_flair else '' }}">All</a>
    {% for val,label in flairs %}
      <a href="{{ url_for('home', flair=val) }}"
         style="margin-left:.5rem; {{ 'text-decoration:underline;' if selected_flair==val else '' }}">{{ label }}</a>
    {% endfor %}
  </div>

  {% if posts and posts|length > 0 %}
    <section>
      {% for post in posts %}
        <article style="margin:1rem 0; padding:1rem; border:1px solid #1f2937; border-radius:8px; background:#0b1224;">
          <h2 style="margin:.25rem 0;">
            <a href="{{ url_for('post_detail', post_id=post.id) }}" style="color:#60a5fa; text-decoration:none;">
              {{ post.title }}
            </a>
            <span class="badge">{{ post.flair.replace('_',' ') }}</span>
            <a href="{{ url_for('api_post_detail', post_id=post.id) }}" style="font-size:.85rem; margin-left:.5rem;">View JSON</a>
          </h2>
          <small>by {{ post.author.username }} â€¢ {{ post.date_posted.strftime('%b %d, %Y') }}</small>
          <p style="margin-top:.5rem;">{{ post.content[:200] }}{% if post.content|length > 200 %}...{% endif %}</p>

          {% if current_user.is_authenticated and current_user.id == post.author.id %}
            <div style="margin-top:.5rem;">
              <a class="btn" href="{{ url_for('edit_post', post_id=post.id) }}">Edit</a>
              <form method="POST"
                    action="{{ url_for('delete_post', post_id=post.id) }}"
                    style="display:inline;"
                    onsubmit="return confirm('Delete this post?');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button class="btn" type="submit" style="background:#b91c1c;">Delete</button>
              </form>
            </div>
          {% endif %}
        </article>
      {% endfor %}
    </section>
  {% else %}
    <p>No posts yet. (Use <code>/post/new</code> to create one.)</p>
  {% endif %}
{% endblock %}
